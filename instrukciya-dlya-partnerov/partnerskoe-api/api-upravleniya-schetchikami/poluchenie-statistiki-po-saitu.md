# Получение статистики по сайту

Метод позволяет получить статистику по сайту по отслеживаемым в Топ-100 метрикам и размерностям.

**URL:** `GET /api/partner/v2.0/projects/<project_id>/report`

**ВНИМАНИЕ!** Лимит на вызов метода - 30 запросов в секунду.

## Параметры запроса <a href="#21" id="21"></a>

| **Поле**    | **Тип** | **Описание**            |
| ----------- | ------- | ----------------------- |
| project\_id | Int     | Идентификатор счетчика. |

## Параметры тела запроса <a href="#22" id="22"></a>

| **Поле** | **Тип**       | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                        |
| -------- | ------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| from     | ISO DateTime  | Параметр, через который задается критерий отбора - время начала выборки в формате ('YYYY-MM-DD HH:MM:SS'). Между днем недели и часом вместо пробела допускается использование символа 'T'. Минимальный диапазон времени 15 минут.                                                                                                                                                                                                   |
| to       | ISO DateTime  | Параметр, через который задается критерий отбора - время окончания выборки в формате ('YYYY-MM-DD HH:MM:SS'). Между днем недели и часом вместо пробела допускается использование символа 'T'. Минимальный диапазон времени 15 минут.                                                                                                                                                                                                |
| limit    | Integer       | Параметр для пагинации результатов запроса. Задает максимальное количество элементов в ответе на запрос.                                                                                                                                                                                                                                                                                                                            |
| offset   | Integer       | Параметр для пагинации результатов запроса. Задает смещение относительно предыдущего запроса. Например, хотим получить выборку из 50-ти элементов с разбивкой по 10. Тогда первый раз вызываем запрос с limit=10 и offset=0 и получаем в ответе первые 10 элементов. Затем еще раз вызываем данный запрос с limit=10 и offset=10 и получаем в ответе вторые 10 элементов. И т.д. – для этого примера всего будет 5 вызовов запроса. |
| filters  | List\[Filter] | Список фильтров, применяемых к запрошенным данным. Содержит массив структур \<Filter> (с вложенными полями, характеризующими каждый из интересующих фильтров). Описание структуры объекта \<Filter> см. ниже.                                                                                                                                                                                                                       |
| select   | List\[String] | Список метрик и размерностей для выбора. Возможные значения см. ниже.                                                                                                                                                                                                                                                                                                                                                               |
| sorters  | List\[Sorter] | Список сортировок, применяемых к запрошенным данным. Содержит массив структур \<Sorter> (с вложенными полями, характеризующими каждую из интересующих сортировок). Описание структуры объекта \<Sorter> см. ниже.                                                                                                                                                                                                                   |

**Структура объекта \<Filter>**

> _Фильтр действует следующим образом: значения из заданной в_ `selectable` _метрики/размерности будут сравниваться с_ `value.` _Какое именно между ними должно быть соответствие, определяется оператором_ `op`_._

| **Поле**   | **Тип** | **Описание**                                                                                                                                                                                  |
| ---------- | ------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| selectable | String  | Метрика или размерность, по которой проходит фильтр. Одно из возможных значений – см. список поддерживаемых метрик и размерностей ниже.                                                       |
| op         | String  | Позволяет задать критерий отбора. Указывается строковое название оператора. Одно из возможных значений: eq (равно), gte (больше или равно), lte (меньше или равно), lt (меньше), gt (больше). |
| value      | String  | Позволяет задать критерий отбора. Указывается конкретное значение для сравнения.                                                                                                              |

**Структура объекта \<Sorter>**

| **Поле**   | **Тип** | **Описание**                                                                                                                                |
| ---------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------- |
| selectable | String  | Метрика или размерность, по которой проходит сортировка. Одно из возможных значений – см. список поддерживаемых метрик и размерностей ниже. |
| order      | String  | Направление сортировки: asc или desc .                                                                                                      |

**Поддерживаемые метрики**

| **Метрика** | **Описание**      |
| ----------- | ----------------- |
| page\_views | Просмотры страниц |
| visits      | Визиты            |
| visitors    | Посетители        |
| bounces     | Отказы            |

**Поддерживаемые размерности**

| Р**азмерность** | **Описание**                                                                                                                                                                                                                                                                                                                                                          |
| --------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| page            | Размерность, в разрезе которой группируются метрики. URL сайта.                                                                                                                                                                                                                                                                                                       |
| page\_no\_args  | Размерность, в разрезе которой группируются метрики. URL без аргументов.                                                                                                                                                                                                                                                                                              |
| title           | Размерность, в разрезе которой группируются метрики. Название счетчика (сайта).                                                                                                                                                                                                                                                                                       |
| chapter\_1      | Размерность, в разрезе которой группируются метрики. Состоит из идентификаторов разделов сайтов, переданных в Топ-100 в качестве первого уровня иерархии.                                                                                                                                                                                                             |
| chapter\_2      | Размерность, в разрезе которой группируются метрики. Состоит из идентификаторов разделов сайта, переданных в Топ-100 в качестве второго уровня иерархии.                                                                                                                                                                                                              |
| chapter\_3      | Размерность, в разрезе которой группируются метрики. Состоит из идентификаторов разделов сайта, переданных в Топ-100 в качестве третьего уровня иерархии.                                                                                                                                                                                                             |
| chapter\_4      | Размерность, в разрезе которой группируются метрики. Состоит из идентификаторов разделов сайта, переданных в Топ-100 в качестве четвертого уровня иерархии.                                                                                                                                                                                                           |
| chapter\_5      | Размерность, в разрезе которой группируются метрики. Состоит из идентификаторов разделов сайта, переданных в Топ-100 в качестве пятого уровня иерархии.                                                                                                                                                                                                               |
| chapter\_depth  | Размерность, в разрезе которой группируются метрики. Состоит из значений от 1 до 5, характеризующих глубину иерархии (вложенности) размеченных разделов (страниц) сайта. Если данная размерность используется как фильтр \<Filter>, то в итоговую выборку попадут данные по разделам сайта, глубина иерархии которых не превосходит задаваемую через данный параметр. |

> _**Примечание:** Топ-100 отслеживает иерархию страниц, вложенностью до 5 уровней. Страницы сайта могут быть размечены таким образом, чтобы при просмотре передавалась бы информация об идентификаторе просматриваемой страницы – при необходимости с указанием идентификаторов родительских страниц (подробнее в_ [_документации_](https://top-100-writer.gitbook.io/top100-documentation/razmetka-celevykh-deistvii/razmetka-razdelov-saita)_)._

**Пример запроса**

```
POST /api/partner/v2.0/projects/648840/report HTTP/1.1
Accept: application/json, */*
Accept-Encoding: gzip, deflate
Authorization: key KtdCzvnscS1U6ovSkvkoY6lAv8nu0mntoyapwrAmhFXSHlGAhmxKb0AFrqo4Qd7Y
Connection: keep-alive
Content-Length: 375
Content-Type: application/json
Host: statstand11.top100.rambler.tech:8080
User-Agent: HTTPie/0.9.9
{
    "filters": [
        {
            "op": "eq",
            "selectable": "chapter_1",
            "value": "CHAMP_HOCKEY"
        }
        ],
        "from": "2017-10-01",
        "to": "2017-10-27",
        "limit": 5,
        "select": [
            "page",
            "page_views",
            "chapter_2"
        ],
        "sorters": [
            {
                "order": "desc",
                "selectable": "page_views"
            }
    ]
}
```

## Параметры тела ответа <a href="#23" id="23"></a>

| **Поле**   | **Тип**       | **Описание**                                                                                                                    |
| ---------- | ------------- | ------------------------------------------------------------------------------------------------------------------------------- |
| meta       |               | Структура с вложенными полями: dimensions, metrics, rows, totals. Их описание см. ниже в таблице.                               |
| dimensions | List\[String] | Названия размерностей, заданные в запросе через параметр select.                                                                |
| metrics    | List\[String] | Названия запрошенных метрик, заданные в запросе через параметр select.                                                          |
| rows       | Int           | Количество отобранных и обработанных записей.                                                                                   |
| totals     | List\[Int]    | Рассчитанные значения метрик без разбивки по размерностям.                                                                      |
| result     | List\[DM]     | Вычисленные метрики в разбивке по размерностям. Выводится как массив структур \<DM>. Описание структуры объекта \<DM> см. ниже. |

**Структура объекта \<DM>**

| **Поле**   | **Тип**       | **Описание**                                                                |
| ---------- | ------------- | --------------------------------------------------------------------------- |
| dimensions | List\[String] | Отобранные значения размерностей, заданных в запросе через параметр select. |
| metrics    | List\[Int]    | Метрики, вычисленные в разрезе соответствующих размерностей.                |

**Пример ответа**

```
{
    "meta": {
        "dimensions": [
            "page",
            "chapter_2"
        ],
        "metrics": [
            "page_views"
        ],
        "rows": 21412,
        "totals": [
            19222040
        ]
    },
    "result": [
        {
            "dimensions": [
                "https://www.championat.com/hockey/",
                "CHAMP_HOCKEY_MAIN"
            ],
            "metrics": [
                2181260
            ]
        },
        {
            "dimensions": [
                "https://www.championat.com/hockey/_superleague.html",
                "CHAMP_HOCKEY_SUPERLEAGUE"
            ],
            "metrics": [
                1667760
            ]
        },
        {
            "dimensions": [
                "https://www.championat.com/hockey/_nhl.html",
                "CHAMP_HOCKEY_NHL"
            ],
            "metrics": [
                982540
            ]
        },
        {
            "dimensions": [
                "https://www.championat.com/hockey/_superleague/2202/table/all.html",
                "CHAMP_HOCKEY_SUPERLEAGUE"
            ],
            "metrics": [
                681210
            ]
        },
        {
            "dimensions": [
                "https://www.championat.com/hockey/_nhl/2336/table/all.html",
                "CHAMP_HOCKEY_NHL"
            ],
            "metrics": [
                242940
            ]
        }
    ]
}
```
